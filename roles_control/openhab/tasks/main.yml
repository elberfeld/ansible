---

- name: install packages
  apt:
    pkg: "{{ item }}"
    update_cache: yes
    state: present
  with_items:
    - oracle-java8-jdk
    - openhab2
  notify: restart openhab

- name: Add the user 'openhab' to group gpio 
  user:
    name: openhab
    groups: gpio
    append: yes

- name: openhab sudo configs
  template: src=011_openhab-nopasswd dest=/etc/sudoers.d/011_openhab-nopasswd

- name: enable service
  service: name=openhab2 enabled=yes

- name: openhab configs
  template: src={{ item }} dest=/etc/openhab2/{{ item }} 
  with_items:
    - "items/rfswitches.items"
    - "items/yahoowheather.items"
    - "persistence/influxdb.persist"
    - "rules/rfswitches.rules"
    - "rules/tempcontrol.rules"
    - "services/addons.cfg"
    - "services/influxdb.cfg"
    - "services/rpircswitch.cfg"
    - "things/homematic.things"
    - "things/rfswitches.things"
    - "things/yahoowheather.things"
  notify: restart openhab
 
