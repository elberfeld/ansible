---

- name: create folder struct for telegraf
  file: 
    path: "{{ item }}"
    state: "directory"
  with_items:
    - /srv/telegraf/

- name: Konfig-Dateien erstellen
  template:
    src: "{{ item }}"
    dest: "/srv/telegraf/{{ item }}"
  with_items:
    - Dockerfile
    - docker-compose.yml
    - dns.conf
    - ping.conf
  notify: restart docker_telegraf 

- name: Konfig-Dateien erstellen (intserver)
  template:
    src: "intserver/{{ item }}"
    dest: "/srv/telegraf/{{ item }}"
  with_items:
    - firewall.conf
    - storage.conf
    - switch.conf
  notify: restart docker_telegraf 
  when: inventory_hostname == "intserver"

- name: Script-Dateien erstellen
  template:
    src: "{{ item }}"
    dest: "/srv/telegraf/{{ item }}"
    mode: "o+rwx"
  with_items:
    - test.sh

- name: start telegraf dockers
  docker_service:
    project_src: /srv/telegraf/
    state: present
